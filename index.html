<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Galaxy</title>
    
  </head>
  <body>
    <canvas id="c1" width='900' height='700' style = "background-image: url('https://cdn.pixabay.com/photo/2016/06/05/07/59/stars-1436950_960_720.jpg')">Not supported</canvas>


  <script>
    let c = document.querySelector("#c1");
    let ctx = c.getContext("2d");
	
	let img = new Image();
    img.src = "https://lh3.googleusercontent.com/proxy/sRNl-F3BHo2NxcfGBYLRlDYi3flJbY7_uKYX68FQAlEjGszvEEJQi4hLWBoF-NNDgDN6S1O8zrJveGl-3aA9W9acRM6DYFSys5yRcvnewpJ7u-JVxtg14wq5n2_fHodpAUMip8d4t5CUA9WUemiI"
	
	let imgBen = new Image();
    imgBen.src = "https://lh3.googleusercontent.com/proxy/S6lB9b3MFiFaQjQWDUk2ETKuZZNR5m3ouflV8uVmQ94ULJxXLX8F8Im7sGLKJoWezQlmeIXNUvj6-RixKOyv0EpgAtxcdGyx0KCB2iHsBFVu6VPBWmy02_T61M0p"
	
	let imgPlay = new Image();
    imgPlay.src = "https://cdn4.iconfinder.com/data/icons/transport-circular-2/90/64-512.png"
	  
    let game = {score: 0, lives: 3, level: 0};
	
	let player = {x:50, y:100, radius:imgPlay.naturalWidth*.15};
	let harm = {x:900, y:500, radius: img.naturalWidth*.15};
	let benefit = {x: 900, y:100, radius: imgBen.naturalWidth*.10};

	let upKey = false;
	let downKey = false;
	let rightKey = false;
	let leftKey = false;
	let spaceKey = false;
	  
	//used to detech keys pressed
	const keyDown = (e) =>{
		if(e.keyCode == 39) rightKey = true;
		else if(e.keyCode == 37) leftKey = true;
		else if (e.keyCode == 38) upKey = true;
		else if (e.keyCode == 40) downKey = true;
		else if(e.keyCode == 32) spaceKey = true;
	}	
	const keyUp = (e) => {
		if(e.keyCode == 39) rightKey = false;
		else if(e.keyCode == 37) leftKey = false;
		else if(e.keyCode == 38) upKey = false;
		else if(e.keyCode == 40) downKey = false;
		else if(e.keyCode == 32) spaceKey = false;
	}
	
	document.addEventListener('keydown', keyDown, false);
	document.addEventListener('keyup', keyUp, false);
	
	//eventHandler
	const eventHandler = () =>{
		if(upKey && player["y"] > 5) player["y"] -= 5;
		else if(downKey && (player["y"] < (c.height-20))) player["y"] +=5;
		else if(rightKey && (player["x"] < (c.width-15))) player["x"] +=5;
		else if(leftKey && player["x"] > 5) player["x"] -=5;
		if(player["x"] <= 0) player["x"] = 0;
	}
	
	//draws player object
	const drawPlayer = () => {
		eventHandler();
		ctx.beginPath();
		ctx.drawImage(imgPlay, player["x"], player["y"], imgPlay.naturalWidth*.15, imgPlay.naturalHeight*.15)
      	ctx.closePath();
      	ctx.fillStyle = "blue";
      	ctx.fill();
	}
	
	//collision detector
	const collision = (x, y) =>{
		let first = (x["x"]- y["x"]);
		let second = (x["y"] - y["y"]);
		let distance = Math.sqrt((first-100)*(first-100) + (second)*(second));
		if(distance < (x["radius"] + y["radius"])){
			return true;
		}
	}
	
	const scoreAndLives = () => {
		ctx.font = "25px Arial";
		ctx.fillStyle = "#FFFFFF";
		ctx.fillText("Score: " + game["score"], 25, 25); 
		ctx.fillText("Lives: " + game["lives"], 25, 50);
		ctx.fillText("Level: " + game["level"], 25, 75);
	}
	
    const draw = () => {
      // clear
      ctx.clearRect (0,0, c.width, c.height);
		
      // update values
      if(game["score"] <= 5){
		   game["level"] = 1;
		   harm["x"] -=1;
	  	   benefit["x"] -=1;
	  }
	  else if(game["score"] <= 25){
		  game["level"] = 2;
		   harm["x"] -=3;
	  	   benefit["x"] -=3;
	  }
      else if(game["score"] <=50){
		  game["level"] = 3;
		  harm["x"] -=8;
	  	  benefit["x"] -=8;
	  }
	  else if(game["score"] <= 100){
		  game["level"] = 4;
		  harm["x"] -=11;
	  	  benefit["x"] -=11;
	  }
	  else{
		  window.cancelAnimationFrame();
		  ctx.font = "16px Arial";
		  ctx.fillStyle = "#0095DD";
		  ctx.fillText("YOU WON!", 25,25)
	  }
		
	  eventHandler();
		
      // handle edge condition
	  if (harm["x"] > c.width + harm["radius"]) {
        harm["x"] = -harm["radius"];
      }
		
	  if (benefit["x"] > c.width + benefit["radius"]) {
        benefit["x"] = -harm["radius"];
      }
	
    //objects
	  drawPlayer();
	
	ctx.beginPath();
	ctx.drawImage(img, harm["x"], harm["y"], img.naturalWidth*.15, img.naturalHeight*.15)
	ctx.closePath();
	ctx.fill();
		
		
	  ctx.beginPath();
	  ctx.drawImage(imgBen, benefit["x"], benefit["y"], imgBen.naturalWidth*.10, imgBen.naturalHeight*.10)
	  ctx.closePath();
	  ctx.fill();
		
      //when in collision check to see if colliding with harm or benefit
	  if(collision(player, harm)){
			game["lives"]--;
		    harm["x"] = 900;
		    harm["y"] = Math.random()*(650 - 0) + 0;
		    benefit["x"] = 900;
		    benefit["y"] = Math.random()*(650 - 0) + 0;
		}
		else if(collision(player, benefit)){
			game["score"]++;
			benefit["x"] = 900;
			benefit["y"] = Math.random()*(650 - 0) + 0;
			harm["x"] = 900;
		    harm["y"] = Math.random()*(650 - 0) + 0;
		}
		
//       ctx.fillText("Lives: " + game["lives"], 25,25)
      scoreAndLives();
		
	  // repeat
	  if(game["lives"] > 0){
		  window.requestAnimationFrame(draw);
	  }
	  else{
		  endScreen();
	  }
  
    }
	
	//starting instructions
	const startScreen = () => {
		ctx.font = "50px Arial";
		ctx.fillStyle = "#FFFFFF";
		ctx.fillText("Instructions:", 270, 150); 
		ctx.fillText("Avoid the meteroids", 270, 220);
		ctx.fillText("Catch as many stars", 270, 270);
	}

	//ending instructions
	const endScreen = () => {
		ctx.font = "50px Arial";
		ctx.fillStyle = "#FFFFFF";
		ctx.fillText("You Lost", 350, 150);
		if(spaceKey){
			draw();
		}
	}
	
	
	draw();
	
  </script>


  </body>
</html>